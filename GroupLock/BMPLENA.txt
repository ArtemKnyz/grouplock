# Общая структура
Данные в формате BMP состоят из трёх основных блоков различного размера:
 1.	Заголовок из структуры BITMAPFILEHEADER и блока BITMAPINFO. Последний содержит информационные поля, битовые маски для извлечения значений цветовых каналов (опциональные), таблица цветов (опциональная).
 2.	Цветовой профиль (опциональный).
 3.	Пиксельные данные.
При хранении в файле все заголовки идут с самого первого байта. Пиксельные данные могут находиться на произвольной позиции в файле (она указывается в поле OffBits структуры BITMAPFILEHEADER), в том числе и в удалении от заголовков. 

![](http://cs631829.vk.me/v631829511/1e8f0/EjOgwsoKG4w.jpg)

### BITMAPFILEHEADER
BITMAPFILEHEADER — 14-байтная структура, которая располагается в самом начале файла. Обратите внимание на то, что с самого начала структуры сбивается выравнивание ячеек. Если для вас оно важно, то в оперативной памяти данный заголовок располагайте по чётным адресам, которые не кратны четырём (тогда 32-битные ячейки попадут на выравненные позиции).
![](http://cs629307.vk.me/v629307511/44985/2LOodqsRLn4.jpg)

Сигнатура формата при просмотре содержимого файла текстом в двоичном режиме выглядит как пара ASCII-символов «BM».

### BITMAPINFO
BITMAPINFO в файле идёт сразу за BITMAPFILEHEADER. Адрес этого блока в памяти напрямую также передаётся некоторым функциям WinAPI (например, SetDIBitsToDevice или CreateDIBitmap). 
Данная структура является основной и описательной в формате BMP и поэтому когда просто упомянуто имя поля, то речь идёт о поле в данной структуре.
Блок BITMAPINFO состоит из трёх частей:
1.	Структура с информационными полями.
2.	Битовые маски для извлечения значений цветовых каналов (присутствуют не всегда).
3.	Таблица цветов (присутствует не всегда).
Ниже представлена обзорная таблица по информационным структурам:

| Версия | Размер в байтах   | Описание                                                                                  |
| ------ | ----------------- | ----------------------------------------------------------------------------------------- |
| CORE   | 12                | ширина, высота и битность растра                                                          |
| 3      | 40                | ширина, высота и битность растра, а также формат пикселей, информацию о цветовой таблице и разрешении. |
| 4      | 108               | Отдельно выделены маски каналов, добавлена информация о цветовом пространстве и гамме. |
| 5      | 124               | Добавлено указание предпочтительной стратегии отображения и поддержка профилей ICC. |

![](http://cs629307.vk.me/v629307511/44994/bVQ03tyFsSI.jpg)
![](http://cs629307.vk.me/v629307511/4499c/owKxPguO0H4.jpg)

Из-за идентичности полей в версиях 3, 4 и 5 может показаться, что полем Size можно регулировать количество полей, убирая неиспользуемые. В действительности это не корректно, так как здесь размер играет роль версии (в версии CORE хоть и тоже идентичные поля, но другого размера и типа). Никто не гарантирует, что не могут попасться заголовки меньших или больших размеров с другим набором полей.

### 16-битные информационные поля (версия CORE)

Здесь поля ширины и высоты содержат беззнаковые целые, в то время как 32-битные структуры хранят значения со знаком.
![](http://cs629307.vk.me/v629307511/449a4/NUVuN5at2pQ.jpg)

### 32-битные информационные поля (версии 3, 4 и 5)

![](http://cs631829.vk.me/v631829511/1e8bd/0sk_9nXnGN0.jpg)
![](http://cs631829.vk.me/v631829511/1e8c4/nmZEmZhQU6o.jpg)
![](http://cs631829.vk.me/v631829511/1e8cb/L8p7JQmR7ww.jpg)
![](http://cs631829.vk.me/v631829511/1e8d2/gopdJJAa7u0.jpg)
![](http://cs631829.vk.me/v631829511/1e8d9/gbSz8HX-CaI.jpg)
![](http://cs631829.vk.me/v631829511/1e8e1/dLGnlABxohk.jpg)

### Пример открытия bmp файла:
![](http://cs631829.vk.me/v631829511/1e8e9/qEukcle36ho.jpg)

Особенности при шифровании: При шифровании bmp-файлов информацию о том, зашифрован файл или нет можно хранить следующим образом:

•	В заголовке файла;

•	В RGB матрице при кодировании не заменять последние биты битами новой картинки у первого элемента матрицы, а ввести флаг, по которому и определять, закодированное или нет. ©


Существующие программы для шифрования bmp:
http://gold-free.ru/soft/graph/coding.php

Ссылка на источник: https://ru.wikipedia.org/wiki/BMP